# Werewolf Arena - Purple Agent (Player)
# AgentBeats-compatible Docker image using uv

FROM ghcr.io/astral-sh/uv:python3.13-bookworm

# Create non-root user for security
RUN adduser --disabled-password --gecos "" agent
USER agent
WORKDIR /home/agent

# Copy dependency files first for better caching
COPY --chown=agent:agent pyproject.toml uv.lock* README.md* ./

# Copy application code
COPY --chown=agent:agent backend/src/purple_agent/ ./src/purple_agent/

# Create __init__.py files
RUN touch ./src/__init__.py

# Install dependencies with uv
RUN --mount=type=cache,target=/home/agent/.cache/uv,uid=1000 \
    uv sync --locked 2>/dev/null || uv sync

# Default environment variables
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONPATH=/home/agent/src
ENV LLM_MODEL=gpt-4o-mini

# Expose AgentBeats standard port for purple agent
EXPOSE 9010

# Entry point using uv run
ENTRYPOINT ["uv", "run", "python", "-m", "purple_agent.server"]

# Default arguments (can be overridden)
CMD ["--host", "0.0.0.0", "--port", "9010"]
